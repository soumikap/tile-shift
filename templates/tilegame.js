const easy3x3 = `
<div class="t3x3" id="x1"><img src="/images/easy3x3/easy3x3_part_004.jpg" alt="tile7"></div>
<div class="t3x3" id="x2"><img src="/images/easy3x3/easy3x3_part_008.jpg" alt="tile6"></div>
<div class="t3x3" id="x3"><img src="/images/easy3x3/easy3x3_part_006.jpg" alt="tile1"></div>
<div class="t3x3" id="x4"><img src="/images/easy3x3/easy3x3_part_003.jpg" alt="tile2"></div>
<div class="t3x3" id="x5"><img src="/images/easy3x3/easy3x3_part_005.jpg" alt="tile8"></div>
<div class="t3x3" id="x6"><img src="/images/easy3x3/easy3x3_part_007.jpg" alt="tile4"></div>
<div class="t3x3" id="x7"><img src="/images/easy3x3/easy3x3_part_002.jpg" alt="tile3"></div>
<div class="t3x3" id="x8"><img src="/images/easy3x3/easy3x3_part_001.jpg" alt="tile5"></div>
<div class="t3x3" id="x9"></div>`

const medium3x3 = `
<div class="t3x3" id="x1"><img src="/images/medium3x3/medium3x3_part_001.jpg" alt="tile1"></div>
<div class="t3x3" id="x2"><img src="/images/medium3x3/medium3x3_part_002.jpg" alt="tile2"></div>
<div class="t3x3" id="x3"><img src="/images/medium3x3/medium3x3_part_003.jpg" alt="tile3"></div>
<div class="t3x3" id="x4"><img src="/images/medium3x3/medium3x3_part_004.jpg" alt="tile4"></div>
<div class="t3x3" id="x5"><img src="/images/medium3x3/medium3x3_part_005.jpg" alt="tile5"></div>
<div class="t3x3" id="x6"><img src="/images/medium3x3/medium3x3_part_006.jpg" alt="tile6"></div>
<div class="t3x3" id="x7"><img src="/images/medium3x3/medium3x3_part_007.jpg" alt="tile7"></div>
<div class="t3x3" id="x8"><img src="/images/medium3x3/medium3x3_part_008.jpg" alt="tile8"></div>
<div class="t3x3" id="x9"><img src="/images/medium3x3/medium3x3_part_009.jpg" alt="tile9"></div>`

const hard3x3 = `
<div class="t3x3" id="x1"><img src="/images/hard3x3/hard3x3_part_001.jpg" alt="tile1"></div>
<div class="t3x3" id="x2"><img src="/images/hard3x3/hard3x3_part_002.jpg" alt="tile2"></div>
<div class="t3x3" id="x3"><img src="/images/hard3x3/hard3x3_part_003.jpg" alt="tile3"></div>
<div class="t3x3" id="x4"><img src="/images/hard3x3/hard3x3_part_004.jpg" alt="tile4"></div>
<div class="t3x3" id="x5"><img src="/images/hard3x3/hard3x3_part_005.jpg" alt="tile5"></div>
<div class="t3x3" id="x6"><img src="/images/hard3x3/hard3x3_part_006.jpg" alt="tile6"></div>
<div class="t3x3" id="x7"><img src="/images/hard3x3/hard3x3_part_007.jpg" alt="tile7"></div>
<div class="t3x3" id="x8"><img src="/images/hard3x3/hard3x3_part_008.jpg" alt="tile8"></div>
<div class="t3x3" id="x9"><img src="/images/hard3x3/hard3x3_part_009.jpg" alt="tile9"></div>`

const easy4x4 = `
<div class="t4x4" id="x1"><img src="/images/easy4x4/easy4x4_part_001.jpg" alt="tile1"></div>
<div class="t4x4" id="x2"><img src="/images/easy4x4/easy4x4_part_002.jpg" alt="tile2"></div>
<div class="t4x4" id="x3"><img src="/images/easy4x4/easy4x4_part_003.jpg" alt="tile3"></div>
<div class="t4x4" id="x4"><img src="/images/easy4x4/easy4x4_part_004.jpg" alt="tile4"></div>
<div class="t4x4" id="x5"><img src="/images/easy4x4/easy4x4_part_005.jpg" alt="tile5"></div>
<div class="t4x4" id="x6"><img src="/images/easy4x4/easy4x4_part_006.jpg" alt="tile6"></div>
<div class="t4x4" id="x7"><img src="/images/easy4x4/easy4x4_part_007.jpg" alt="tile7"></div>
<div class="t4x4" id="x8"><img src="/images/easy4x4/easy4x4_part_008.jpg" alt="tile8"></div>
<div class="t4x4" id="x9"><img src="/images/easy4x4/easy4x4_part_009.jpg" alt="tile9"></div>
<div class="t4x4" id="x10"><img src="/images/easy4x4/easy4x4_part_010.jpg" alt="tile10"></div>
<div class="t4x4" id="x11"><img src="/images/easy4x4/easy4x4_part_011.jpg" alt="tile11"></div>
<div class="t4x4" id="x12"><img src="/images/easy4x4/easy4x4_part_012.jpg" alt="tile12"></div>
<div class="t4x4" id="x13"><img src="/images/easy4x4/easy4x4_part_013.jpg" alt="tile13"></div>
<div class="t4x4" id="x14"><img src="/images/easy4x4/easy4x4_part_014.jpg" alt="tile14"></div>
<div class="t4x4" id="x15"><img src="/images/easy4x4/easy4x4_part_015.jpg" alt="tile15"></div>
<div class="t4x4" id="x16"><img src="/images/easy4x4/easy4x4_part_016.jpg" alt="tile16"></div>`

const medium4x4 = `
<div class="t4x4" id="x1"><img src="/images/medium4x4/medium4x4_part_001.jpg" alt="tile1"></div>
<div class="t4x4" id="x2"><img src="/images/medium4x4/medium4x4_part_002.jpg" alt="tile2"></div>
<div class="t4x4" id="x3"><img src="/images/medium4x4/medium4x4_part_003.jpg" alt="tile3"></div>
<div class="t4x4" id="x4"><img src="/images/medium4x4/medium4x4_part_004.jpg" alt="tile4"></div>
<div class="t4x4" id="x5"><img src="/images/medium4x4/medium4x4_part_005.jpg" alt="tile5"></div>
<div class="t4x4" id="x6"><img src="/images/medium4x4/medium4x4_part_006.jpg" alt="tile6"></div>
<div class="t4x4" id="x7"><img src="/images/medium4x4/medium4x4_part_007.jpg" alt="tile7"></div>
<div class="t4x4" id="x8"><img src="/images/medium4x4/medium4x4_part_008.jpg" alt="tile8"></div>
<div class="t4x4" id="x9"><img src="/images/medium4x4/medium4x4_part_009.jpg" alt="tile9"></div>
<div class="t4x4" id="x10"><img src="/images/medium4x4/medium4x4_part_010.jpg" alt="tile10"></div>
<div class="t4x4" id="x11"><img src="/images/medium4x4/medium4x4_part_011.jpg" alt="tile11"></div>
<div class="t4x4" id="x12"><img src="/images/medium4x4/medium4x4_part_012.jpg" alt="tile12"></div>
<div class="t4x4" id="x13"><img src="/images/medium4x4/medium4x4_part_013.jpg" alt="tile13"></div>
<div class="t4x4" id="x14"><img src="/images/medium4x4/medium4x4_part_014.jpg" alt="tile14"></div>
<div class="t4x4" id="x15"><img src="/images/medium4x4/medium4x4_part_015.jpg" alt="tile15"></div>
<div class="t4x4" id="x16"><img src="/images/medium4x4/medium4x4_part_016.jpg" alt="tile16"></div>`

const hard4x4 = `
<div class="t4x4" id="x1"><img src="/images/hard4x4/hard4x4_part_001.jpg" alt="tile1"></div>
<div class="t4x4" id="x2"><img src="/images/hard4x4/hard4x4_part_002.jpg" alt="tile2"></div>
<div class="t4x4" id="x3"><img src="/images/hard4x4/hard4x4_part_003.jpg" alt="tile3"></div>
<div class="t4x4" id="x4"><img src="/images/hard4x4/hard4x4_part_004.jpg" alt="tile4"></div>
<div class="t4x4" id="x5"><img src="/images/hard4x4/hard4x4_part_005.jpg" alt="tile5"></div>
<div class="t4x4" id="x6"><img src="/images/hard4x4/hard4x4_part_006.jpg" alt="tile6"></div>
<div class="t4x4" id="x7"><img src="/images/hard4x4/hard4x4_part_007.jpg" alt="tile7"></div>
<div class="t4x4" id="x8"><img src="/images/hard4x4/hard4x4_part_008.jpg" alt="tile8"></div>
<div class="t4x4" id="x9"><img src="/images/hard4x4/hard4x4_part_009.jpg" alt="tile9"></div>
<div class="t4x4" id="x10"><img src="/images/hard4x4/hard4x4_part_010.jpg" alt="tile10"></div>
<div class="t4x4" id="x11"><img src="/images/hard4x4/hard4x4_part_011.jpg" alt="tile11"></div>
<div class="t4x4" id="x12"><img src="/images/hard4x4/hard4x4_part_012.jpg" alt="tile12"></div>
<div class="t4x4" id="x13"><img src="/images/hard4x4/hard4x4_part_013.jpg" alt="tile13"></div>
<div class="t4x4" id="x14"><img src="/images/hard4x4/hard4x4_part_014.jpg" alt="tile14"></div>
<div class="t4x4" id="x15"><img src="/images/hard4x4/hard4x4_part_015.jpg" alt="tile15"></div>
<div class="t4x4" id="x16"><img src="/images/hard4x4/hard4x4_part_016.jpg" alt="tile16"></div>`

const easy5x5 = `
<div class="t5x5" id="x1"><img src="" alt="tile"></div>
<div class="t5x5" id="x2"><img src="" alt="tile"></div>
<div class="t5x5" id="x3"><img src="" alt="tile"></div>
<div class="t5x5" id="x4"><img src="" alt="tile"></div>
<div class="t5x5" id="x5"><img src="" alt="tile"></div>
<div class="t5x5" id="x6"><img src="" alt="tile"></div>
<div class="t5x5" id="x7"><img src="" alt="tile"></div>
<div class="t5x5" id="x8"><img src="" alt="tile"></div>
<div class="t5x5" id="x9"><img src="" alt="tile"></div>
<div class="t5x5" id="x10"><img src="" alt="tile"></div>
<div class="t5x5" id="x11"><img src="" alt="tile"></div>
<div class="t5x5" id="x12"><img src="" alt="tile"></div>
<div class="t5x5" id="x13"><img src="" alt="tile"></div>
<div class="t5x5" id="x14"><img src="" alt="tile"></div>
<div class="t5x5" id="x15"><img src="" alt="tile"></div>
<div class="t5x5" id="x16"><img src="" alt="tile"></div>
<div class="t5x5" id="x17"><img src="" alt="tile"></div>
<div class="t5x5" id="x18"><img src="" alt="tile"></div>
<div class="t5x5" id="x19"><img src="" alt="tile"></div>
<div class="t5x5" id="x20"><img src="" alt="tile"></div>
<div class="t5x5" id="x21"><img src="" alt="tile"></div>
<div class="t5x5" id="x22"><img src="" alt="tile"></div>
<div class="t5x5" id="x23"><img src="" alt="tile"></div>
<div class="t5x5" id="x24"><img src="" alt="tile"></div>
<div class="t5x5" id="x25"><img src="" alt="tile"></div>`

const medium5x5 = `
<div class="t5x5" id="x1"><img src="" alt="tile"></div>
<div class="t5x5" id="x2"><img src="" alt="tile"></div>
<div class="t5x5" id="x3"><img src="" alt="tile"></div>
<div class="t5x5" id="x4"><img src="" alt="tile"></div>
<div class="t5x5" id="x5"><img src="" alt="tile"></div>
<div class="t5x5" id="x6"><img src="" alt="tile"></div>
<div class="t5x5" id="x7"><img src="" alt="tile"></div>
<div class="t5x5" id="x8"><img src="" alt="tile"></div>
<div class="t5x5" id="x9"><img src="" alt="tile"></div>
<div class="t5x5" id="x10"><img src="" alt="tile"></div>
<div class="t5x5" id="x11"><img src="" alt="tile"></div>
<div class="t5x5" id="x12"><img src="" alt="tile"></div>
<div class="t5x5" id="x13"><img src="" alt="tile"></div>
<div class="t5x5" id="x14"><img src="" alt="tile"></div>
<div class="t5x5" id="x15"><img src="" alt="tile"></div>
<div class="t5x5" id="x16"><img src="" alt="tile"></div>
<div class="t5x5" id="x17"><img src="" alt="tile"></div>
<div class="t5x5" id="x18"><img src="" alt="tile"></div>
<div class="t5x5" id="x19"><img src="" alt="tile"></div>
<div class="t5x5" id="x20"><img src="" alt="tile"></div>
<div class="t5x5" id="x21"><img src="" alt="tile"></div>
<div class="t5x5" id="x22"><img src="" alt="tile"></div>
<div class="t5x5" id="x23"><img src="" alt="tile"></div>
<div class="t5x5" id="x24"><img src="" alt="tile"></div>
<div class="t5x5" id="x25"><img src="" alt="tile"></div>`

const hard5x5 = `
<div class="t5x5" id="x1"><img src="" alt="tile"></div>
<div class="t5x5" id="x2"><img src="" alt="tile"></div>
<div class="t5x5" id="x3"><img src="" alt="tile"></div>
<div class="t5x5" id="x4"><img src="" alt="tile"></div>
<div class="t5x5" id="x5"><img src="" alt="tile"></div>
<div class="t5x5" id="x6"><img src="" alt="tile"></div>
<div class="t5x5" id="x7"><img src="" alt="tile"></div>
<div class="t5x5" id="x8"><img src="" alt="tile"></div>
<div class="t5x5" id="x9"><img src="" alt="tile"></div>
<div class="t5x5" id="x10"><img src="" alt="tile"></div>
<div class="t5x5" id="x11"><img src="" alt="tile"></div>
<div class="t5x5" id="x12"><img src="" alt="tile"></div>
<div class="t5x5" id="x13"><img src="" alt="tile"></div>
<div class="t5x5" id="x14"><img src="" alt="tile"></div>
<div class="t5x5" id="x15"><img src="" alt="tile"></div>
<div class="t5x5" id="x16"><img src="" alt="tile"></div>
<div class="t5x5" id="x17"><img src="" alt="tile"></div>
<div class="t5x5" id="x18"><img src="" alt="tile"></div>
<div class="t5x5" id="x19"><img src="" alt="tile"></div>
<div class="t5x5" id="x20"><img src="" alt="tile"></div>
<div class="t5x5" id="x21"><img src="" alt="tile"></div>
<div class="t5x5" id="x22"><img src="" alt="tile"></div>
<div class="t5x5" id="x23"><img src="" alt="tile"></div>
<div class="t5x5" id="x24"><img src="" alt="tile"></div>
<div class="t5x5" id="x25"><img src="" alt="tile"></div>`


window.onload = function () {
    document.getElementById("game-container").innerHTML = "hello";
    startgame();
}

function startgame() {
    // let dim = document.querySelector("#gridsize").value;
    // let diff = document.querySelector("#difficulty").value;
    let griddiv = document.querySelector("#game-container");
    
    //gamegrid = new Grid(dim, diff, griddiv);
    gamegrid = new Grid("3x3", "easy", griddiv);
    // add event listener for each div inside griddiv
    for (let i = 1; i <= gamegrid.dim * gamegrid.dim; i++) {
        document.getElementById("x"+i).addEventListener('click', function() {
            const thistile = Number(this.id.substring(1));
            //alert(typeof(thistile));
            let empty = gamegrid.getadjemptytile(thistile);
            //alert("empty: "+empty);
            if (empty !== 0) {
                gamegrid.movetile(thistile, empty);
            }
        });
    }
}

var gamegrid;

class Grid {
    #dim;
    #diff;
    #moves;
    #board;
    #imgheader = "/images/";
    #emptytile;
    moves;

    constructor(dim, diff, griddiv) {

        if (dim === "3x3") {
            this.#dim = 3;
            if (diff === "easy") {
                this.#board = easy3x3;
                this.#imgheader+="/easy3x3/easy3x3_part_0";
            } else if (diff === "Medium") {
                this.#board = medium3x3;
                this.#imgheader+="/medium3x3/medium3x3_part_0";
            } else if (diff === "Hard") {
                this.#board = hard3x3;
                this.#imgheader+="/hard3x3/hard3x3_part_0";
            }
        } else if (dim === "4x4") {
            this.#dim = 4;
            if (diff === "Easy") {
                this.#board = easy4x4;
                this.#imgheader+="/easy4x4/easy4x4_part_0";
            } else if (diff === "Medium") {
                this.#board = medium4x4;
                this.#imgheader+="/medium4x4/medium4x4_part_0";
            } else if (diff === "Hard") {
                this.#board = hard4x4;
                this.#imgheader+="/hard4x4/hard4x4_part_0";
            }
        } else if (dim === "5x5") {
            this.#dim = 5;
            if (diff === "Easy") {
                this.#board = easy5x5;
                this.#imgheader+="/easy5x5/easy5x5_part_0";
            } else if (diff === "Medium") {
                this.#board = medium5x5;
                this.#imgheader+="/medium5x5/medium5x5_part_0";
            } else if (diff === "Hard") {
                this.#board = hard5x5;
                this.#imgheader+="/hard5x5/hard5x5_part_0";
            }
        }
        this.moves = 0;
        this.#diff = diff;
        this.#emptytile = this.#dim * this.#dim;
        griddiv.innerHTML = this.#board;
    }

    get dim() {
        return this.#dim;
    }

    get imgheader() {
        return this.#imgheader;
    }

    getadjemptytile(id) {
        let dim = this.#dim;
        const maxidx = this.#dim * this.#dim;
        // 123 -> 1, 456 -> 4, 789 -> 7
        const rowstart = Math.floor((id-1) / this.#dim) * this.#dim + 1;
        const rowend = rowstart + (this.#dim - 1);
        //alert("below: "+document.getElementById("x"+(id+dim)).innerHTML.trim());

        // if has left and left is empty, return it
        if (id-1 >= rowstart && document.getElementById("x"+(id-1)).innerHTML.trim() == "") {
            return id-1;
        }
        // if has right and right is empty, return it
        else if (id+1 <= rowend && document.getElementById("x"+(id+1)).innerHTML.trim() == "") {
            return id+1;
        }
        // if has up and up is empty, return it
        else if (id - dim > 0 && document.getElementById("x"+(id-dim)).innerHTML.trim() == "") {
            return id-3;
        }
        // if has down and down is empty, return it
        else if (id + dim <= maxidx && document.getElementById("x"+(id+dim)).innerHTML.trim() == "") {
            return id+3;
        }
        else {
            return 0;
        }
    }

    movetile(from, to) {
        const fromtile = document.getElementById("x"+from);
        const totile = document.getElementById("x"+to);
        const imgtomove = fromtile.innerHTML;
        fromtile.innerHTML = "";
        totile.innerHTML = imgtomove;
        this.moves += 1;
        //alert(this.moves);
        document.getElementById("moves").innerHTML = `moves: ${this.moves}`;
        //alert("before checkwin");
        if (gamegrid.checkwin()) {
            finishgame();
        }
    }
    
    checkwin() {
        for (let i = 1; i <= this.#dim * this.#dim-1; i++) {
            let tileimg = document.getElementById("x"+i).innerHTML;
            let rightimg = tileimg.includes(i+".jpg");
            if (!rightimg) {
                //alert("wrong at: "+i+ " | "+tileimg);
                return false;
            }
        }
        //alert("you win!");
        return true;
    }
}



function finishgame() {
    const lasttile = document.querySelector("#x" + gamegrid.dim*gamegrid.dim);
    if (gamegrid.dim === 3) {
        lasttile.innerHTML = `<img src="${gamegrid.imgheader}09.jpg">`
    }else {
        lasttile.innerHTML = `<img src="${gamegrid.imgheader}${gamegrid.dim*gamegrid.dim}.jpg">`
    }
    document.getElementById("finish").innerHTML = `
    <form action="/tilegame" method="post" id="finalmoves">
        <input type="hidden" value="${gamegrid.moves}" name="moves" id="finalmovesbox">
        <input type="submit" value="finish game"/>
    </form>
    `
}
